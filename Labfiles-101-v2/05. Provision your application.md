# Exercise 4: Validate access to your application on Azure

In this exercise, you will review the pre-deployed Virtual Machine on each spoke VNet, create network security group rules to allow required traffic and you will then test connectivity across your network.
â€‹
## Task 1. Configure access from on-premises to the vnet-prod-001 VNet. 

1. In the search bar of the Azure portal, type **Virtual machines (1)**, then select **Virtual machines (2)** from results.

   ![Create resource](../media/95.png)

1. From the **Virtual machines** page, select **vm-prod-001**.

     ![Create resource](./Media/80.png)

1. On the right side of the **overview** pane view find the IP address and hover the right side of the **public IP address** to copy to the clipboard or record it on notepad.

   ![Create resource](./Media/77.png)

1. In the search bar of the Azure portal, type **Virtual machines (1)**, then select **Virtual machines (2)** from results.

   ![Create resource](../media/95.png)

1. From the **Virtual machines** page, select **vm-prod-002**.

   ![Create resource](./Media/79.png)

1. On the right side of the **overview** pane view find the IP address and hover the right side of the **public IP address** to copy to the clipboard or record it on notepad.

   ![Create resource](./Media/78.png)


1. In the search bar of the Azure portal, type **Network Security Groups (1)**, then select **Network Security Groups (2)** from results.

   ![Create resource](./Media/42.png)

1. On the **Network Security Groups** page, Select the **nsg-prod-001**. 

    ![Create resource](./Media/43.png)

1. From the left menu, select the **Inbound security rules (1)** and click the **+Add(2)**. 

    ![Create resource](./Media/44.png)
   
1. Fill out as per the screen below to **allow** on-premises **HTTP** access to the **vm-prod-001-VM**. Then click **Add**. 

    ![Create resource](./Media/45.png)

1. Repeat the steps per below **deny** on-premises **RDP** access to the **vm-prod-001-VM** then click **Add**. 

    ![Create resource](./Media/46.png)

## Task 2. Configure access from on-premises to the  vnet-prod-002 VNet.  

1. In the search bar of the Azure portal, type **Network Security Groups (1)**, then select **Network Security Groups (2)** from results.

   ![Create resource](./Media/42.png)

1. On the **Network Security Groups** page, Select the **nsg-prod-002**. 

    ![Create resource](./Media/47.png)

1. From the left menu, select the **Inbound security rules (1)** and click the **+Add(2)**.

    ![Create resource](./Media/52.png)

1. Fill out as per the screen below to **allow** on-premises **HTTP** access to the vm-prod-002-VM. Then click **Add**. 

   ![Create resource](./Media/48.png)

1. Repeat the steps per below to **allow** on-premises **RDP** access to the vm-prod-002-VM then click **Add**.  

   ![Create resource](./Media/49.png)

1. On the Left menu, select **Outbound security rules (1)** then click on the **+ Add (2)**.

   ![Create resource](./Media/51.png)

1. Fill out as per the screen below to **deny** on-premises **RDP** access to the vm-prod-002-VM. Then click **Add**.

    ![Create resource](./Media/50.png)

1. Validate network security rules and connectivity.

1. From your **Lab-VM** Search for **Windows Powershell ISE (1)** and open a **Windows Powershell ISE (2)**.

   ![Create resource](./Media/74.png)

1. From the **Administrator: Windows PowerShell ISE** console, run the following to test VM-prod-001 **RDP** connection.

    ```
      Test-NetConnection -ComputerName 10.2.0.4 -Port 3389 -InformationLevel 'Detailed'
      ```
1. You can Notice that **TcpTestSucceeded** is **False**:

   ![Create resource](./Media/66.png)


1. From the **Administrator: Windows PowerShell ISE** console, run the following to test VM-prod-001 **HTTP** connection.

    ```
      Test-NetConnection -ComputerName 10.2.0.4 -Port 80 -InformationLevel 'Detailed'
      ```
1. You can Notice that **TcpTestSucceeded** is **False**.

   ![Create resource](./Media/67.png)

1. From the **Administrator: Windows PowerShell ISE** console, run the following to test VM-prod-002 **RDP** connection.

    ```
      Test-NetConnection -ComputerName 10.3.0.4 -Port 3389 -InformationLevel 'Detailed'
      ```
1. You can Notice that **TcpTestSucceeded** is **False**.

   ![Create resource](./Media/68.png)


1. From the **Administrator: Windows PowerShell ISE** console, run the following to test VM-prod-002 **HTTP** connection.

    ```
      Test-NetConnection -ComputerName 10.3.0.4 -Port 80 -InformationLevel 'Detailed'
      ```
1. You can Notice that **TcpTestSucceeded** is **False**.

   ![Create resource](./Media/69.png)

1. From your **Lab-VM** Search for **Remote Desktop Connection (1)** and open a **Remote Desktop Connection  (2)**.:

    ![Create resource](./Media/62.png)

1. In the Computer text bot enter the **public IP of vm-prod-001-VM (1)** and click on **Connect (2)**

   ![Create resource](./Media/63.png)

1. On the **Enter Your credentials** pop-up fill the following details:

   - **Username (1)** : Enter **.\demouser**
   - **Password (2)** : Enter **<inject key="adminPassword"></inject>**
   - Click on **OK (3)**

   ![Create resource](./Media/56.png)

1. You may receive a warning certificate during the sign-in process. Click **Yes** or to create the connection and connect to your deployed VM. You should connect successfully.

   ![Create resource](./Media/64.png)

1. You are Successfully able to **connect** to the Virtual machine.

   ![Create resource](./Media/65.png)

1. In the RDP session of **VM-prod-001** and inside **VM-prod-001** Search for **Windows Powershell ISE (1)** and open a **Windows Powershell ISE (2)**.

   ![Create resource](./Media/74.png)

1. From the **Administrator: Windows PowerShell ISE** console, run the following to test VM-prod-002 **RDP** connection.

    ```
      Test-NetConnection -ComputerName 10.3.0.4 -Port 3389 -InformationLevel 'Detailed'
      ```
1. You can Notice that **TcpTestSucceeded** is **True**.

   ![Create resource](./Media/70.png)

1. From the **Administrator: Windows PowerShell ISE** console, run the following to test VM-prod-002 **HTTP** connection.

    ```
      Test-NetConnection -ComputerName 10.3.0.4 -Port 80 -InformationLevel 'Detailed'
      ```
1. You can Notice that **TcpTestSucceeded** is **True**.

    ![Create resource](./Media/71.png)

1. From your **Lab-VM** Search for **Remote Desktop Connection (1)** and open a **Remote Desktop Connection  (2)**.:

    ![Create resource](./Media/62.png)

1. In the Computer text bot enter the public IP of **vm-prod-002-VM (1)** and click on **Connect (2)**

     ![Create resource](./Media/72.png)

1. On the **Enter Your credentials** pop-up fill the following details:

   - **Username (1)** : Enter **.\demouser**
   - **Password (2)** : Enter **<inject key="adminPassword"></inject>**
   - Click on **OK (3)**

     ![Create resource](./Media/56.png)

1. You may receive a warning certificate during the sign-in process. Click **Yes** or to create the connection and connect to your deployed VM. You should connect successfully.

   ![Create resource](./Media/73.png)

1. Inside **vm-prod-002-VM** Search for **Windows Powershell ISE (1)** and open a **Windows Powershell ISE (2)**.

    ![Create resource](./Media/74.png)

1. From the **Administrator: Windows PowerShell ISE** console, run the following to test VM-prod-001 **RDP** connection.

    ```
      Test-NetConnection -ComputerName 10.2.0.4 -Port 3389 -InformationLevel 'Detailed'
      ```
1. You can Notice that **TcpTestSucceeded** is **True**.

   ![Create resource](./Media/75.png)


1. From the **Administrator: Windows PowerShell ISE** console, run the following to test VM-prod-001 **HTTP** connection.

    ```
      Test-NetConnection -ComputerName 10.2.0.4 -Port 80 -InformationLevel 'Detailed'
      ```
1. You can Notice that **TcpTestSucceeded** is **True**.

    ![Create resource](./Media/76.png)

    













